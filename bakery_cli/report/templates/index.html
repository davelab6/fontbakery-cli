<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Summary</title>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
</head>
<body>
    <div class="container">
        <ul class="nav nav-tabs">
          <li class="active"><a href="index.html">Summary</a></li>
          <li><a href="upstream.html">Upstream Tests</a></li>
          <li><a href="tests.html">Downstream Tests</a></li>
          <li><a href="buildlog.html">Build Log</a></li>
          <li><a href="metadata.html">METADATA.json</a></li>
          <li><a href="bakery-yaml.html">bakery.yaml</a></li>
          <li><a href="description.html">Description</a></li>
        </ul>

        {% for font in fonts %}
        <h4>{{ font.basename }}</h4>

        <style>
            @font-face {font-family: {{ font.basename }}; src: url({{ font.path }});}
            .face{{ loop.index }} {font-family: {{ font.basename }}; font-size: 24pt;}
        </style>

        <div class="face{{ loop.index }}">
            Grumpy wizards make toxic brew for the evil Queen and Jack
        </div>
        {% endfor %}

        <h4>Tests Charts</h4>
        {% for font in tests.keys() %}
          {% set blockers = filter_with_tag(tests[font], 'required') %}
          <div class="row">
            <div class="col-xs-6">
              <div id="piechart{{ loop.index }}"></div>
            </div>
            <div class="col-xs-6">
              {% if blockers %}
              <h5>Blockers</h5>
              {% for blocker in blockers %}
              <div>
                {{blocker['methodName']}}: <br />{{blocker['methodDoc']}}<br />
                <blockquote class="text-danger">{{ blocker['err_msg']}}</blockquote>
              </div>
              {% endfor %}
              {% endif %}
            </div>
          </div>
        {% endfor %}

        <h4>Summary Chart</h4>
        <div id="piechartSum"></div>

        <h4>Vertical metrics</h4>
        <pre>{{ vmet }}</pre>

        <h4>TTF Table Sizes</h4>

        <table class="table-striped table-bordered table-condensed tablesorter">
            <tr>
                <th></th>
                {% for f in ttftablesizes[1] %}
                <th>{{ f }}</th>
                {% endfor %}
            </tr>

            {% for table in ttftablesizes[0] %}{# loop for list of available tables #}
            <tr>
                <td>{{ table }}</td>
                {% for f in ttftablesizes[1] %}
                    <td>{{ ttftablesizes[1][f].get(table, '') }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        </table>

        {% if autohinting_sizes %}
        <h4>ttfautohint filesize impact statistic</h4>
        <table class="table-striped table-bordered table-condensed tablesorter">
        {% for t in autohinting_sizes %}
            <tr>
                <th colspan="2">{{ t['fontname'] }}</th>
            </tr>
            <tr>
                <td>Before</td>
                <td>{{ t['origin'] }}</td>
            </tr>
            <tr>
                <td>After</td>
                <td>{{ t['processed'] }}</td>
            </tr>
            <tr>
                <td>Increase</td>
                <td>{{ t['processed'] - t['origin'] }}</td>
            </tr>
            <tr>
                <td>Change</td>
                <td>{{ '{:.3f}x'.format(t['processed'] / t['origin']) }}</td>
            </tr>
        {% endfor %}
        </table>
        {% endif %}

        {% for fontaine in fontaineFonts %}
        <h4 class="toggle"><i class="fa"></i> {{ fontaine._full_name }}</h4>
        <div>

            <dl class="" style="columns:100px 3; -webkit-columns:100px 3; /* Safari and Chrome */ -moz-columns:100px 3; /* Firefox */">
                <dt>Common Name</dt>
                <dd>{{ fontaine.common_name }}</dd>
                <dt>Full Name</dt>
                <dd>{{ fontaine._full_name }}</dd>
                <dt>PostScript Name</dt>
                <dd>{{ fontaine._postscript }}    </dd>
                <dt>Subfamily</dt>
                <dd>{{ fontaine.sub_family }}     </dd>
                <dt>Weight</dt>
                <dd>{{ fontaine.weight }}         </dd>
                <dt>Version</dt>
                <dd>{{ fontaine.version }}        </dd>
                <dt>UniqueID</dt>
                <dd>{{ fontaine._unique_id }}     </dd>
                <dt>Copyright</dt>
                <dd>{{ fontaine.copyright }}      </dd>
                <dt>License</dt>
                <dd>{{ fontaine.license }}        </dd>
                <dt>License URL</dt>
                <dd><a href="{{ fontaine.license_url }}">{{ fontaine.license_url }}</a></dd>
                <dt>Designer</dt>
                <dd>{{ fontaine.designer }}       </dd>
                <dt>Designer URL</dt>
                <dd><a href="{{ fontaine.designer_url }}">{{ fontaine.designer_url }}</a></dd>
                <dt>Vendor</dt>
                <dd>{{ fontaine.vendor }}         </dd>
                <dd><a href="{{ fontaine.vendor_url }}">{{ fontaine.vendor_url }}</a></dd>
                <dt>has_fixed_sizes</dt>
                <dd>{{ fontaine.has_fixed_sizes }}</dd>
                <dt>is_fixed_width</dt>
                <dd>{{ fontaine.is_fixed_width }} </dd>
                <dt>style_flags</dt>
                <dd>{{ fontaine.style_flags }}    </dd>
            </dl>

        <table class="table table-striped table-bordered table-condensed tablesorter" id="" style="">
        <thead>
          <tr>
            <th width='20%'>Character Set</th>
            <th>Coverage</th>
            <th>Missing Characters</th>
          </tr>
        </thead>
        <tbody>
        {% for charmap, support, missing, missingchars in get_orthography(fontaine) %}
          <tr class="{{ support | replace('full','success') | replace('partial','info') | replace('fragmentary','warning') | replace('unsupported','error') }}">
            <td>{{ charmap.common_name }}
            <td>{{ missing }}
            <td>{% for item in missingchars %} {{ '&#{};'.format(item)|safe }} {% endfor %}
          </tr>
        {% endfor %}
        </tbody>
        </table>
        </div>

    {% endfor %}
    </div>
</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.min.js"></script>
<script>
$(function(){
    $('.tablesorter').tablesorter();
    });
</script>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {

    {% set chartsum = {"success": 0, "failure": 0, "fixed": 0, "error": 0} %}
    {%- for font in tests.keys() %}
    var data = google.visualization.arrayToDataTable([
        ['Tests', '#'],
        ['Success {{ tests[font]['success']|length }}', {{ tests[font]['success']|length }}],
        ['Fixed {{ tests[font]['fixed']|length }}', {{ tests[font]['fixed']|length }}],
        ['Failed {{ tests[font]['failure']|length }}', {{ tests[font]['failure']|length }}],
        ['Error {{ tests[font]['error']|length }}', {{ tests[font]['error']|length }}]
    ]);

    var options = {
      title: "{{ font }}",
      is3D: true,
      colors: ['#468847', '#3a87ad', '#b94a48', '#c09853'],
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart{{ loop.index }}'));
    chart.draw(data, options);

    {% set chartsum = {
      "success": chartsum.success + tests[font]['success']|length,
      "error": chartsum.error + tests[font]['error']|length,
      "failure": chartsum.failure + tests[font]['failure']|length,
      "fixed": chartsum.fixed + tests[font]['fixed']|length,
      } %}

    {% if loop.last %}

    var data = google.visualization.arrayToDataTable([
        ['Tests', '#'],
        ['Success {{ chartsum['success'] }}', {{ chartsum['success'] }}],
        ['Fixed {{ chartsum['fixed'] }}', {{ chartsum['fixed'] }}],
        ['Failed {{ chartsum['failure'] }}', {{ chartsum['failure'] }}],
        ['Error {{ chartsum['error'] }}', {{ chartsum['error'] }}]
    ]);

    var options = {
      title: "Summary chart",
      is3D: true,
      colors: ['#468847', '#3a87ad', '#b94a48', '#c09853'],
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechartSum'));
    chart.draw(data, options);
    {% endif %}
    {% endfor %}
  }
</script>
</html>
