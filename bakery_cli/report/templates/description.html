<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ ("Description") }}</title>
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
  <script src="//cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.min.js"></script>
</head>
<body>
<div class="container-fluid">
  {% from "macros.html" import report_navigation with context %}
  {{ report_navigation(activeitem='description') }}
  <div class="col-sm-5 col-md-5">
    <textarea name="description" id="description">{{ data|safe }}</textarea>
    <div id="editor"></div>
  </div>
  <div class="col-sm-5 col-md-5">
    <span id="preview"></span>
  </div>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container-fluid">
    <ul class="footer-links">
      <li><a href='https://github.com/googlefonts/fontbakery-cli/edit/master/bakery_cli/report/templates/{{ current_page }}'>Edit this page's template</a></li>
      <li><a href='https://github.com/googlefonts/fontbakery-cli/'>Made with Font Bakery</a> (<a href='http://www.gnu.org/philosophy/free-sw.html'>libre software</a> available under the terms of the <a href='https://github.com/googlefonts/fontbakery-cli/blob/master/LICENSE.txt'>Apache 2.0 license</a>.)</li>
      <li>Please <a href='https://github.com/googlefonts/fontbakery-cli/issues/new'>report bugs</a>, suggest features, and contribute on <a href='https://github.com/googlefonts/fontbakery-cli/'>GitHub <i class='icon-github'></i></a></li>
      {% if app_version %}
        <li>{{ app_version.commit }}, {{ app_version.date }}</li>
      {% endif %}
    </ul>
  </div>
</footer>

<script>
  $(document).ready(function () {
    var editor = ace.edit("editor");
    editor.setTheme("ace/theme/solarized_light");
    editor.getSession().setMode("ace/mode/html");
    editor.getSession().setUseSoftTabs(false);
    editor.getSession().setUseWrapMode(true);
    editor.setHighlightActiveLine(false);

    var textarea = $('textarea[name="description"]').hide();
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setValue(textarea.val());
    editor.getSession().on('change', function(){
      textarea.val(editor.getSession().getValue());
    });

    var updatePreview = function() {
      var htmlStr = editor.getSession().getValue();
      $('#preview').html(htmlStr);
    };

    // From https://gist.github.com/hostilefork/6325151 & http://stackoverflow.com/questions/11584061/
    var heightUpdateFunction = function() {
      var newHeight =
          editor.getSession().getScreenLength()
              * editor.renderer.lineHeight
              + editor.renderer.scrollBar.getWidth()
              + 200;
      $('#editor').height(newHeight.toString() + "px");
      $('#editor-section').height(newHeight.toString() + "px");
      // This call is required for the editor to fix all of its inner structure for adapting to a change in size
      editor.resize();
    };
    // Set initial size and preview to match initial content
    updatePreview();
    heightUpdateFunction();
    // Whenever a change happens inside the ACE editor, update the size and preview again
    editor.getSession().on('change', heightUpdateFunction);
    editor.getSession().on('change', updatePreview);
  });
</script>
</body>
</html>
