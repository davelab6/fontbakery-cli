<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ ("Downstream Tests") }}</title>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" />
</head>
<body>
{% set repo_gh_pages = build_repo_url('tree','gh-pages') %}
{% set repo_url = build_repo_url() %}
<div class="container-fluid">
    <ul class="nav nav-tabs">
      <li><a href="https://github.com/fontdirectory/yesevaone/tree/gh-pages" target="_blank"><i class="fa fa-github"></i> gh-pages</a></li>
      <li><a href="https://github.com/fontdirectory/yesevaone/" target="_blank"><i class="fa fa-github-square"></i> Github Page</a></li>
      <li><a href="index.html">Summary</a></li>
      <li><a href="review.html">Review</a></li>
      <li><a href="upstream.html">Upstream Tests</a></li>
      <li class="active"><a href="tests.html">Downstream Tests</a></li>
      <li><a href="buildlog.html">Build Log</a></li>
      <li><a href="metadata.html">METADATA.json</a></li>
      <li><a href="bakery-yaml.html">bakery.yaml</a></li>
      <li><a href="description.html">Description</a></li>
    </ul>

    <h3>Downstream Tests</h3>

    <table class="table table-striped table-bordered table-condensed tablesorter">
        <thead>
        <tr>
          <th>Category</th>
          <th>Description</th>
          <th>File</th>
          <th>Result</th>
          <th>Status</th>
        </tr>
        </thead>
        {% set map = {'success': 'OK', 'failure': 'FAIL', 'error': 'ERROR', 'fixed': 'FIXED'} %}
        {% set testTypes = { 'error': 'danger', 'failure': 'error', 'success': 'success', 'fixed': 'info'} %}

        {% for font in tests %}
            <div id="piechart{{ loop.index }}"></div>
            {%- for testType, icon in testTypes.items() | sort %}
                {% for item in sort(tests[font][testType]) %}
                <tr>
                    <td>{{ item.tags|join(', ') }}</td>
                    <td><span class="apopover" data-placement="top" data-content="{{ item.name|replace('.','/') }}.py:{{ item.methodName }}()">{{ item.methodDoc|default('None') }}</span></td>
                    <td>{{ font }}</td>
                    <td>{{ item.err_msg }}</td>
                    <td>{{ map[testType] }}</td>
                </tr>
                {% endfor %}

            {%- endfor %}
        {% else %}
            <h4>There is no data to display</h4>
        {% endfor %}
    </table>

</div>

</body>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery.tablesorter/2.17.7/js/jquery.tablesorter.min.js"></script>
<script>
    $(function(){
        // apopover class used on dashboard
        $('.apopover').each(function (index, item) {
            $(item).popover();
        });
        $('.tablesorter').tablesorter();
    })
</script>
<style>
    .popover {
        max-width: 1980px;
        font-family: Courier;
    }
</style>
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("visualization", "1", {packages:["corechart"]});
  google.setOnLoadCallback(drawChart);
  function drawChart() {

    {% set chartsum = {"success": 0, "failure": 0, "fixed": 0, "error": 0} %}
    {%- for font in tests.keys() %}
    var data = google.visualization.arrayToDataTable([
        ['Tests', '#'],
        ['Success {{ tests[font]['success']|length }}', {{ tests[font]['success']|length }}],
        ['Fixed {{ tests[font]['fixed']|length }}', {{ tests[font]['fixed']|length }}],
        ['Failed {{ tests[font]['failure']|length }}', {{ tests[font]['failure']|length }}],
        ['Error {{ tests[font]['error']|length }}', {{ tests[font]['error']|length }}]
    ]);

    var options = {
      title: "{{ font }}",
      is3D: true,
      colors: ['#468847', '#3a87ad', '#b94a48', '#c09853'],
    };

    var chart = new google.visualization.PieChart(document.getElementById('piechart{{ loop.index }}'));
    chart.draw(data, options);

    {% set chartsum = {
      "success": chartsum.success + tests[font]['success']|length,
      "error": chartsum.error + tests[font]['error']|length,
      "failure": chartsum.failure + tests[font]['failure']|length,
      "fixed": chartsum.fixed + tests[font]['fixed']|length,
      } %}
    {% endfor %}

  }
</script>


</html>
